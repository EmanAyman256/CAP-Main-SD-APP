sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageToast"],function(e,r,t){"use strict";return e.extend("project1.controller.AddServiceMaster",{onInit:function(){var e=this.getView();var r=new sap.ui.model.json.JSONModel({ServiceNumbers:[]});e.setModel(r,"view");fetch("./odata/v4/sales-cloud/ServiceNumbers").then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).then(e=>{console.log("Fetched ServiceNumbers:",e.value);r.setData({ServiceNumbers:Array.isArray(e.value)?e.value:[]});r.refresh(true)}).catch(e=>{console.error("Error fetching ServiceNumbers:",e);sap.m.MessageBox.error("Failed to load ServiceNumbers: "+e.message)});this.getOwnerComponent().getRouter().getRoute("serviceMaster").attachMatched(this._onRouteMatched,this);fetch("./odata/v4/sales-cloud/ServiceTypes").then(e=>e.json()).then(r=>{var t=new sap.ui.model.json.JSONModel(r.value);e.setModel(t,"serviceTypes")});fetch("./odata/v4/sales-cloud/MaterialGroups").then(e=>e.json()).then(r=>{var t=new sap.ui.model.json.JSONModel(r.value);e.setModel(t,"materialGroups")});fetch("./odata/v4/sales-cloud/UnitOfMeasurements").then(e=>e.json()).then(r=>{var t=new sap.ui.model.json.JSONModel(r.value);e.setModel(t,"unitsOfMeasurement")})},_onRouteMatched:function(e){var r=e.getParameter("arguments");var t=this.getView().getModel("view");fetch("./odata/v4/sales-cloud/ServiceNumbers").then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).then(e=>{console.log("Refetched ServiceNumbers on route matched:",e.value);t.setData({ServiceNumbers:Array.isArray(e.value)?e.value:[]});t.refresh(true);console.log("Updated ServiceNumbers array:",t.getProperty("/ServiceNumbers"))}).catch(e=>{console.error("Error refetching ServiceNumbers:",e);sap.m.MessageBox.error("Failed to refresh table: "+e.message)})},_generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})},_isValidNumber:function(e){return!isNaN(parseInt(e,10))&&e.trim()!==""},onAddPress:function(){var e=this.getView();var r=e.byId("_IDGenInput1").getValue();var t=e.byId("_IDGenInput2").getValue();var s=e.byId("_IDGenInput3").getValue();var a=e.byId("_IDGenInput4").getValue();var o=e.byId("_IDGenCheckBox1").getSelected();var n=e.byId("_IDGenCheckBox3").getSelected();var i=e.byId("_IDGenInput5").getValue();var u=e.byId("_IDGenInput9").getValue();var l=e.byId("_IDGenSelect5").getSelectedKey();var c=e.byId("_IDGenSelect1").getSelectedKey();var d=e.byId("_IDGenSelect2").getSelectedKey();var v=e.byId("_IDGenSelect3").getSelectedKey();var h=e.byId("_IDGenSelect4").getSelectedKey();var m=e.byId("_IDGenCheckBox4").getSelected();if(!this._isValidNumber(r)){sap.m.MessageBox.error("Please enter a valid Service Number (ID).");return}if(!t||!s){sap.m.MessageBox.error("Search Term and Description are required.");return}var g={serviceNumberCode:this._generateUUID(),serviceNumberCodeString:`SN-${r.padStart(3,"0")}`,noServiceNumber:parseInt(r,10),searchTerm:t,description:s,serviceText:a||null,shortTextChangeAllowed:o,deletionIndicator:n,numberToBeConverted:this._isValidNumber(i)?parseInt(i,10):null,convertedNumber:this._isValidNumber(u)?parseInt(u,10):null,serviceTypeCode:l||null,unitOfMeasurementCode:c||null,toBeConvertedUnitOfMeasurement:d||null,defaultUnitOfMeasurement:v||null,mainItem:m,materialGroupCode:h||null,lastChangeDate:(new Date).toISOString().split("T")[0]};console.log("Payload to be sent:",g);fetch("./odata/v4/sales-cloud/ServiceNumbers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).then(e=>{if(!e.ok){return e.json().then(r=>{throw new Error(r.error?.message||e.statusText)})}return e.json().catch(()=>g)}).then(e=>{sap.m.MessageBox.success("ServiceMaster saved successfully!,Press OK To return to the main page",{title:"Success",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){var r=sap.ui.core.UIComponent.getRouterFor(this);r.navTo("serviceMaster")}}.bind(this)})}).catch(e=>{console.error("Error saving ServiceMaster:",e);sap.m.MessageBox.error("Error: "+e.message)})}})});
//# sourceMappingURL=AddServiceMaster.controller.js.map