sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/m/Dialog","sap/m/Input","sap/m/Button","sap/m/Label","sap/m/VBox","sap/ui/model/json/JSONModel"],function(e,t,o,n,i,s,r,c){"use strict";return e.extend("project1.controller.Model",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("model").attachPatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel({Models:[]});this.getView().setModel(e,"view");fetch("./odata/v4/sales-cloud/Currencies").then(e=>e.json()).then(e=>{var t=new sap.ui.model.json.JSONModel(e.value);this.getView().setModel(t,"currencies")});fetch("./odata/v4/sales-cloud/ModelSpecifications").then(e=>e.json()).then(t=>{e.setData({Models:t.value});this.getView().byId("modelTable").setModel(e)}).catch(e=>{console.error("Error fetching models",e)})},_onRouteMatched:function(){this._loadModels()},_loadModels:function(){var e=new sap.ui.model.json.JSONModel;fetch("./odata/v4/sales-cloud/ModelSpecifications").then(e=>e.json()).then(t=>{e.setData({Models:t.value});console.log("Models",t.value);this.getView().byId("modelTable").setModel(e)}).catch(e=>{console.error("Error fetching models",e)})},onEdit:function(e){var r=e.getSource();var c=r.getParent().getParent().getBindingContext();if(!c){t.warning("Error: Unable to retrieve row data");return}var l=c.getObject();var d=this.getView().getModel("view");if(!this._oEditDialog){this._oModelServSpecInput=new n;this._oBlockingIndicatorInput=new sap.m.CheckBox;this._oServiceSelectionInput=new sap.m.CheckBox;this._oDescriptionInput=new n;this._oSearchTermInput=new n;this._oCurrencyCodeSelect=new sap.m.Select({id:"currency",class:"sapUiSmallMarginStart",width:"200px",forceSelection:false,items:{path:"currencies>/",template:new sap.ui.core.Item({key:"{currencies>currencyCode}",text:"{currencies>description}"})}});this._oCurrencyCodeSelect.insertItem(new sap.ui.core.Item({key:"",text:"Cancel"}),0);this._oEditDialog=new o({title:"Edit Model",titleAlignment:"Center",contentWidth:"600px",content:new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",content:[new s({text:"modelServSpec",design:"Bold"}),this._oModelServSpecInput,new s({text:"blockingIndicator",design:"Bold"}),this._oBlockingIndicatorInput,new s({text:"serviceSelection",design:"Bold"}),this._oServiceSelectionInput,new s({text:"description",design:"Bold"}),this._oDescriptionInput,new s({text:"searchTerm",design:"Bold"}),this._oSearchTermInput,new s({text:"currencyCode",design:"Bold"}),this._oCurrencyCodeSelect]}),beginButton:new i({text:"Save",type:"Emphasized",press:()=>{const e={modelServSpec:this._oModelServSpecInput.getValue(),blockingIndicator:this._oBlockingIndicatorInput.getSelected(),serviceSelection:this._oServiceSelectionInput.getSelected(),description:this._oDescriptionInput.getValue(),searchTerm:this._oSearchTermInput.getValue(),currencyCode:this._oCurrencyCodeSelect.getSelectedKey()};fetch(`./odata/v4/sales-cloud/ModelSpecifications('${l.modelSpecCode}')`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(!e.ok)throw new Error("Update failed");return e.json()}).then(t=>{console.log(t);var o=this.getView().byId("modelTable").getModel();var n=o.getProperty("/Models")||[];var i=n.findIndex(e=>e.modelSpecCode===l.modelSpecCode);console.log(i);if(i>-1){n[i]=e;o.setProperty("/Models",n)}sap.m.MessageToast.show("Model updated successfully");this._oEditDialog.close()}).catch(e=>{sap.m.MessageBox.error("Error updating model: "+e.message)})}}),endButton:new i({text:"Cancel",press:()=>this._oEditDialog.close()})});this.getView().addDependent(this._oEditDialog)}this._oModelServSpecInput.setValue(l.modelServSpec);this._oBlockingIndicatorInput.setSelected(!!l.blockingIndicator);this._oServiceSelectionInput.setSelected(!!l.serviceSelection);this._oDescriptionInput.setValue(l.description);this._oSearchTermInput.setValue(l.searchTerm);this._oCurrencyCodeSelect.setValue(l.currencyCode);this._oEditDialog.open()},onDelete:function(e){var o=e.getSource().getBindingContext();if(o){var n=o.getPath();var i=this.getView().byId("modelTable").getModel();var s=i.getProperty(n);if(!s){sap.m.MessageBox.error("Could not find model data for deletion.");return}t.confirm("Are you sure you want to delete "+s.modelServSpec+"?",{title:"Confirm Deletion",onClose:function(e){if(e===t.Action.OK){fetch(`./odata/v4/sales-cloud/ModelSpecifications('${s.modelSpecCode}')`,{method:"DELETE"}).then(e=>{if(!e.ok){throw new Error("Failed to delete: "+e.statusText)}var t=i.getProperty("/Models");var o=t.findIndex(e=>e.modelSpecCode===s.modelSpecCode);if(o>-1){t.splice(o,1);i.setProperty("/Models",t)}sap.m.MessageToast.show("Model deleted successfully!")}).catch(e=>{console.error("Error deleting Model:",e);sap.m.MessageBox.error("Error: "+e.message)})}}})}},onPress(){this.getOwnerComponent().getRouter().navTo("addModel")},onNavigateToModelServices:function(e){const t=e.getSource().getBindingContext();const o=t.getObject();const n=o.modelSpecCode;console.log("Nav to Service",o);this.getOwnerComponent().getRouter().navTo("modelServices",{modelSpecCode:n,Record:o})}})});
//# sourceMappingURL=Model.controller.js.map