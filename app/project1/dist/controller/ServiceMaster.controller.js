sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/Dialog","sap/m/VBox","sap/m/Text","sap/m/Button","sap/ui/export/Spreadsheet","sap/ui/export/library","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,a,o,r,i,s,n,l){"use strict";return e.extend("project1.controller.ServiceMaster",{onInit:function(){this.getOwnerComponent().getRouter().getRoute("serviceMaster").attachPatternMatched(this._onRouteMatched,this);var e=new sap.ui.model.json.JSONModel({ServiceNumbers:[]});const t=new sap.ui.model.json.JSONModel({editData:{searchTerm:""}});this.getView().setModel(t,"editModel");this.getView().setModel(e,"view");fetch("./odata/v4/sales-cloud/ServiceNumbers").then(e=>{if(!e.ok){throw new Error(`HTTP error! Status: ${e.status}, ${e.statusText}`)}return e.json()}).then(t=>{console.log("Fetched ServiceNumbers:",t);const a=Array.isArray(t.value)?t.value:[];e.setData({ServiceNumbers:a});console.log("ServiceNumbers set in model:",e.getProperty("/ServiceNumbers"));e.refresh(true)}).catch(e=>{console.error("Error fetching ServiceNumbers:",e);sap.m.MessageBox.error("Failed to load ServiceNumbers: "+e.message)});fetch("./odata/v4/sales-cloud/ServiceTypes").then(e=>e.json()).then(e=>{var t=new sap.ui.model.json.JSONModel(e.value);this.getView().setModel(t,"serviceTypes")});fetch("./odata/v4/sales-cloud/MaterialGroups").then(e=>e.json()).then(e=>{var t=new sap.ui.model.json.JSONModel(e.value);this.getView().setModel(t,"materialGroups")});fetch("./odata/v4/sales-cloud/UnitOfMeasurements").then(e=>e.json()).then(e=>{var t=new sap.ui.model.json.JSONModel(e.value);this.getView().setModel(t,"unitsOfMeasurement")})},_onRouteMatched:function(){this._loadModels()},_loadModels:function(){const e=this.getView().getModel("view");var t=new sap.ui.model.json.JSONModel;fetch("./odata/v4/sales-cloud/ServiceNumbers").then(e=>{if(!e.ok){throw new Error(`HTTP error! Status: ${e.status}, ${e.statusText}`)}return e.json()}).then(a=>{console.log("Fetched ServiceNumbers:",a);const o=Array.isArray(a.value)?a.value:[];t.setData({ServiceNumbers:o});console.log("ServiceNumbers set in model:",t.getProperty("/ServiceNumbers"));this.getView().byId("serviceMaster").setModel(t);this.getView().setModel(t,"view");e.updateBindings(true)}).catch(e=>{console.error("Error fetching ServiceNumbers:",e);sap.m.MessageBox.error("Failed to load ServiceNumbers: "+e.message)})},onEdit:function(){var e=this.byId("serviceMaster");var t=e.getSelectedItem();if(!t){sap.m.MessageBox.warning("Please select an item to edit");return}var a=t.getBindingContext("view");if(!a){sap.m.MessageBox.error("No binding context found for the selected item");console.error("Binding context is undefined for selected item:",t);return}var o=a.getObject();if(!o){sap.m.MessageBox.error("No data found for the selected item");console.error("Selected data is undefined:",a);return}if(!this._oEditDialog){this._oEditDialog=new sap.m.Dialog({title:"Edit Service Master",titleAlignment:"Center",contentWidth:"700px",resizable:true,draggable:true,content:[],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:this.onSaveEdit.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:()=>this._oEditDialog.close()})});this.getView().addDependent(this._oEditDialog)}var r=new sap.ui.model.json.JSONModel({editData:Object.assign({},o)});this._oEditDialog.setModel(r,"editModel");this._oEditDialog.removeAllContent();var i=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanL:4,labelSpanM:4,columnsL:1,columnsM:1,maxContainerCols:2,emptySpanL:1,emptySpanM:1,content:[]});i.addStyleClass("sapUiSmallMargin sapUiNoContentPadding");function s(e,t){i.addContent(new sap.m.Label({text:e}));i.addContent(t)}s("Service Number Code",new sap.m.Input({value:"{editModel>/editData/serviceNumberCode}",editable:false}));s("Service Number",new sap.m.Input({value:"{editModel>/editData/serviceNumberCodeString}",editable:false}));s("Search Term",new sap.m.Input({value:"{editModel>/editData/searchTerm}"}));s("Description",new sap.m.Input({value:"{editModel>/editData/description}"}));s("Service Text",new sap.m.Input({value:"{editModel>/editData/serviceText}"}));s("Service Type",new sap.m.Select({items:{path:"serviceTypes>/",template:new sap.ui.core.Item({key:"{serviceTypes>serviceTypeCode}",text:"{serviceTypes>description}"})},selectedKey:"{editModel>/editData/serviceTypeCode}"}));s("Material Group",new sap.m.Select({items:{path:"materialGroups>/",template:new sap.ui.core.Item({key:"{materialGroups>materialGroupCode}",text:"{materialGroups>description}"})},selectedKey:"{editModel>/editData/materialGroupCode}"}));s("Base Unit of Measurement",new sap.m.Select({items:{path:"unitsOfMeasurement>/",template:new sap.ui.core.Item({key:"{units>code}",text:"{units>description}"})},selectedKey:"{editModel>/editData/baseUnitOfMeasurement}"}));s("Number To Be Converted",new sap.m.Input({value:"{editModel>/editData/numberToBeConverted}"}));s("To Be Converted Unit of Measurement",new sap.m.Select({items:{path:"unitsOfMeasurement>/",template:new sap.ui.core.Item({key:"{units>code}",text:"{units>description}"})},selectedKey:"{editModel>/editData/toBeConvertedUnitOfMeasurement}",width:"100%"}));s("Converted Number",new sap.m.Input({value:"{editModel>/editData/convertedNumber}"}));s(" Converted Unit of Measurement",new sap.m.Select({items:{path:"unitsOfMeasurement>/",template:new sap.ui.core.Item({key:"{units>code}",text:"{units>description}"})},selectedKey:"{editModel>/editData/defaultUnitOfMeasurement}",width:"100%"}));s("Main Item",new sap.m.CheckBox({selected:"{editModel>/editData/mainItem}"}));s("Short Text Change Allowed",new sap.m.CheckBox({selected:"{editModel>/editData/shortTextChangeAllowed}"}));s("Deletion Indicator",new sap.m.CheckBox({selected:"{editModel>/editData/deletionIndicator}"}));var n=new sap.m.ScrollContainer({height:"500px",vertical:true,content:[i]});this._oEditDialog.addContent(n);this._oEditDialog.open()},onSaveEdit:function(){var e=this._oEditDialog.getModel("editModel");var t=e.getProperty("/editData");console.log(t);if(t.lastChangeDate instanceof Date){t.lastChangeDate=t.lastChangeDate.toISOString().split("T")[0]}else if(typeof t.lastChangeDate==="string"&&t.lastChangeDate.includes("/")){var a=t.lastChangeDate.split("/");if(a.length===3){let e=a[0].padStart(2,"0");let o=a[1].padStart(2,"0");let r=a[2].length===2?"20"+a[2]:a[2];t.lastChangeDate=`${r}-${e}-${o}`}}var o={serviceNumberCode:t.serviceNumberCode,searchTerm:t.searchTerm,description:t.description,serviceTypeCode:t.serviceTypeCode,materialGroupCode:t.materialGroupCode,serviceText:t.serviceText,mainItem:t.mainItem,shortTextChangeAllowed:t.shortTextChangeAllowed,deletionIndicator:t.deletionIndicator,convertedNumber:t.convertedNumber,numberToBeConverted:t.numberToBeConverted,toBeConvertedUnitOfMeasurement:t.toBeConvertedUnitOfMeasurement,defaultUnitOfMeasurement:t.defaultUnitOfMeasurement,baseUnitOfMeasurement:t.baseUnitOfMeasurement};console.log(o);fetch(`./odata/v4/sales-cloud/ServiceNumbers(${t.serviceNumberCode})`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).then(e=>{sap.m.MessageToast.show("Service updated successfully");var a=this.getView().byId("serviceMaster").getModel("view");var r=a.getProperty("/ServiceNumbers")||[];var i=r.findIndex(e=>e.serviceNumberCode===t.serviceNumberCode);if(i>-1){r[i]={...r[i],...o};console.log(r);a.setProperty("/ServiceNumbers",r);a.refresh(true)}else{console.error("Updated item not found in ServiceNumbers array")}this._oEditDialog.close()}).catch(e=>{console.error("Update failed",e);sap.m.MessageBox.error("Update failed: "+e.message)})},onNavigateToAddServiceMaster(){this.getOwnerComponent().getRouter().navTo("addServiceMaster")},onShowDetails:function(){var e=this.byId("serviceMaster");var t=e.getSelectedItem();if(!t){sap.m.MessageBox.warning("Please, select an item");return}var a=t.getBindingContext("view");var o=a.getObject();if(!this._oValueHelpDialog){this._oValueHelpDialog=new sap.m.Dialog({title:"Service Master Details",titleAlignment:"Center",contentWidth:"800px",resizable:true,draggable:true,content:[],endButton:new sap.m.Button({text:"Close",press:()=>this._oValueHelpDialog.close()})});this.getView().addDependent(this._oValueHelpDialog)}this._oValueHelpDialog.setTitle("Service Master: "+(o.description||""));this._oValueHelpDialog.removeAllContent();var r=[{label:"Service Master Code",value:o.serviceNumberCode},{label:"Service Number",value:o.serviceNumberCodeString},{label:"Search Term",value:o.searchTerm},{label:"Description",value:o.description},{label:"Service Text",value:o.serviceText},{label:"Service Type Code",value:o.serviceTypeCode},{label:"Material Group Code",value:o.materialGroupCode},{label:"Base Unit of Measurement",value:o.baseUnitOfMeasurement},{label:"Number To Be Converted",value:o.numberToBeConverted},{label:"To Be Converted Unit of Measurement",value:o.toBeConvertedUnitOfMeasurement},{label:"Converted Number",value:o.convertedNumber},{label:"Converted Unit of Measurement",value:o.defaultUnitOfMeasurement},{label:"Main Item",value:o.mainItem?"Yes":"No"},{label:"Short Text Change Allowed",value:o.shortTextChangeAllowed?"Yes":"No"},{label:"Deletion Indicator",value:o.deletionIndicator?"Yes":"No"},{label:"Last Change Date",value:o.lastChangeDate}];var i=new sap.ui.layout.form.SimpleForm({editable:false,layout:"ResponsiveGridLayout",labelSpanM:4,labelSpanL:4,emptySpanL:1,emptySpanM:1,columnsL:1,columnsM:1,maxContainerCols:2,content:[]});i.addStyleClass("sapUiSmallMargin sapUiNoContentPadding");r.forEach(function(e){i.addContent(new sap.m.Label({text:e.label}));i.addContent(new sap.m.Input({value:e.value!=null?e.value.toString():"",editable:false,width:"100%"}))});var s=new sap.m.ScrollContainer({height:"400px",vertical:true,content:[i]});this._oValueHelpDialog.addContent(s);this._oValueHelpDialog.open()},_generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,a=e==="x"?t:t&3|8;return a.toString(16)})},onCopy:function(){var e=this.byId("serviceMaster");var t=e.getSelectedItem();if(!t){sap.m.MessageBox.warning("Please select an item to copy");return}var a=t.getBindingContext("view");if(!a){sap.m.MessageBox.error("No binding context found for the selected item");console.error("Binding context is undefined for selected item:",t);return}var o=Object.assign({},a.getObject());if(!o){sap.m.MessageBox.error("No data found for the selected item");return}var r=this._generateUUID();o.serviceNumberCode=r;o.serviceNumberCodeString=r;if(!this._oCopyDialog){this._oCopyDialog=new sap.m.Dialog({title:"Copy Service Master",titleAlignment:"Center",contentWidth:"700px",resizable:true,draggable:true,content:[],beginButton:new sap.m.Button({text:"Save",type:"Emphasized",press:this._onCopySave.bind(this)}),endButton:new sap.m.Button({text:"Cancel",press:()=>this._oCopyDialog.close()})});this.getView().addDependent(this._oCopyDialog)}var i=new sap.ui.model.json.JSONModel({copyData:Object.assign({},o)});this._oCopyDialog.setModel(i,"copyModel");this._oCopyDialog.removeAllContent();var s=new sap.ui.layout.form.SimpleForm({editable:true,layout:"ResponsiveGridLayout",labelSpanL:4,labelSpanM:4,columnsL:1,columnsM:1,maxContainerCols:2,emptySpanL:1,emptySpanM:1,content:[]});s.addStyleClass("sapUiSmallMargin sapUiNoContentPadding");function n(e,t){s.addContent(new sap.m.Label({text:e}));s.addContent(t)}n("Service Number Code",new sap.m.Input({value:"{copyModel>/copyData/serviceNumberCode}",editable:false}));n("Search Term",new sap.m.Input({value:"{copyModel>/copyData/searchTerm}"}));n("Description",new sap.m.Input({value:"{copyModel>/copyData/description}"}));n("Service Text",new sap.m.Input({value:"{copyModel>/copyData/serviceText}"}));n("Service Type",new sap.m.Select({items:{path:"serviceTypes>/",template:new sap.ui.core.Item({key:"{serviceTypes>serviceTypeCode}",text:"{serviceTypes>description}"})},selectedKey:"{copyModel>/copyData/serviceTypeCode}"}));n("Material Group",new sap.m.Select({items:{path:"materialGroups>/",template:new sap.ui.core.Item({key:"{materialGroups>materialGroupCode}",text:"{materialGroups>description}"})},selectedKey:"{copyModel>/copyData/materialGroupCode}"}));n("Base Unit of Measurement",new sap.m.Select({items:{path:"unitsOfMeasurement>/",template:new sap.ui.core.Item({key:"{units>code}",text:"{units>description}"})},selectedKey:"{copyModel>/copyData/baseUnitOfMeasurement}"}));n("Number To Be Converted",new sap.m.Input({value:"{copyModel>/copyData/numberToBeConverted}"}));n("To Be Converted Unit of Measurement",new sap.m.Select({items:{path:"unitsOfMeasurement>/",template:new sap.ui.core.Item({key:"{units>code}",text:"{units>description}"})},selectedKey:"{copyModel>/copyData/toBeConvertedUnitOfMeasurement}",width:"100%"}));n("Converted Number",new sap.m.Input({value:"{copyModel>/copyData/convertedNumber}"}));n("Converted Unit of Measurement",new sap.m.Select({items:{path:"unitsOfMeasurement>/",template:new sap.ui.core.Item({key:"{units>code}",text:"{units>description}"})},selectedKey:"{copyModel>/copyData/defaultUnitOfMeasurement}",width:"100%"}));n("Main Item",new sap.m.CheckBox({selected:"{copyModel>/copyData/mainItem}"}));n("Short Text Change Allowed",new sap.m.CheckBox({selected:"{copyModel>/copyData/shortTextChangeAllowed}"}));n("Deletion Indicator",new sap.m.CheckBox({selected:"{copyModel>/copyData/deletionIndicator}"}));var l=new sap.m.ScrollContainer({height:"500px",vertical:true,content:[s]});this._oCopyDialog.addContent(l);this._oCopyDialog.open()},_onCopySave:function(){var e=this._oCopyDialog.getModel("copyModel");var t=e.getProperty("/copyData");console.log("Copy Data:",t);var a={serviceNumberCode:this._generateUUID(),searchTerm:t.searchTerm,description:t.description,serviceTypeCode:t.serviceTypeCode,materialGroupCode:t.materialGroupCode,serviceText:t.serviceText,mainItem:t.mainItem,shortTextChangeAllowed:t.shortTextChangeAllowed,deletionIndicator:t.deletionIndicator,convertedNumber:t.convertedNumber,numberToBeConverted:t.numberToBeConverted,toBeConvertedUnitOfMeasurement:t.toBeConvertedUnitOfMeasurement,defaultUnitOfMeasurement:t.defaultUnitOfMeasurement,baseUnitOfMeasurement:t.baseUnitOfMeasurement};fetch("./odata/v4/sales-cloud/ServiceNumbers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(e=>{if(!e.ok)throw new Error(e.statusText);return e.json()}).then(e=>{sap.m.MessageToast.show("Service copied successfully");var t=this.getView().getModel("view");var a=t.getProperty("/ServiceNumbers")||[];a.push(e);t.setProperty("/ServiceNumbers",a);console.log("Updated ServiceNumbers array:",t.getProperty("/ServiceNumbers"));t.refresh(true);var o=this.byId("serviceMaster");console.log("Table items binding:",o.getBinding("items"));this._loadModels();var r=this.getView().byId("serviceMaster").getModel("view");var i=r.getProperty("/ServiceNumbers")||[];r.setProperty("/ServiceNumbers",i);r.refresh(true);this._oCopyDialog.close()}).catch(e=>{console.error("Copy failed:",e);sap.m.MessageBox.error("Copy failed: "+e.message)})},onExport:function(){var e=this.getView().getModel("view");var t=e.getProperty("/ServiceNumbers");if(!t||t.length===0){sap.m.MessageBox.warning("No data available to export");return}var a=[{label:"Service Master Code",property:"serviceNumberCode"},{label:"Search Term",property:"searchTerm"},{label:"Description",property:"description"},{label:"Last Changed Date",property:"lastChangeDate"},{label:"Service Type",property:"serviceText"}];var o={workbook:{columns:a},dataSource:t,fileName:"ServiceMaster.xlsx",worker:false};var r=new sap.ui.export.Spreadsheet(o);r.build().then(()=>{sap.m.MessageToast.show("Export finished!")}).finally(()=>{r.destroy()})},onDeletePress:function(){var e=this.byId("serviceMaster");var t=e.getSelectedItem();console.log(t);if(!t){l.warning("Please select a row to delete");return}var a=t.getBindingContext("view");if(!a){l.error("No binding context found for the selected item");console.error("Binding context is undefined for selected item:",t);return}var o=a.getObject();if(!o||!o.serviceNumberCode){l.error("Invalid data selected for deletion");console.error("Selected data is invalid:",o);return}var r=o.serviceNumberCode;console.log("Deleting ServiceNumber with code:",r);l.confirm("Are you sure you want to delete this service master?",{title:"Confirm Deletion",onClose:function(t){if(t===l.Action.OK){fetch(`/odata/v4/sales-cloud/ServiceNumbers('${r}')`,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(t=>{if(!t.ok){return t.json().then(e=>{throw new Error(e.error?.message||t.statusText)})}MessageToast.show("Service Master deleted successfully!");var a=this.getView().getModel("view");var o=a.getProperty("/ServiceNumbers")||[];console.log("Current ServiceNumbers array:",o);var i=o.findIndex(e=>e.serviceNumberCode===r);if(i>-1){o.splice(i,1);a.setProperty("/ServiceNumbers",o);a.refresh(true);console.log("Updated ServiceNumbers array:",a.getProperty("/ServiceNumbers"))}else{console.warn("Deleted item not found in ServiceNumbers array")}e.removeSelections(true)}).catch(e=>{console.error("Error deleting Service Master:",e);l.error("Failed to delete Service Master: "+e.message)})}}.bind(this)})},onSearch:function(e){var t=e.getParameter("newValue");var a=this.byId("serviceMaster");var o=a.getBinding("items");if(t&&t.length>0){var r=new sap.ui.model.Filter("serviceNumberCode",sap.ui.model.FilterOperator.Contains,t);var i=new sap.ui.model.Filter("searchTerm",sap.ui.model.FilterOperator.Contains,t);var s=new sap.ui.model.Filter("description",sap.ui.model.FilterOperator.Contains,t);var n=new sap.ui.model.Filter({filters:[r,i,s],and:false});o.filter([n])}else{o.filter([])}}})});
//# sourceMappingURL=ServiceMaster.controller.js.map