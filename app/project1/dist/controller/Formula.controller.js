sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/m/Input","sap/m/Label","sap/m/VBox"],function(Controller,MessageToast,Input,Label,VBox){"use strict";return Controller.extend("project1.controller.Formula",{onInit:function(){var e=new sap.ui.model.json.JSONModel({paramCount:0,params:[],paramIdsText:"",relationText:"",formulaReview:"",testValues:[],operations:[{key:"+",text:"+"},{key:"-",text:"-"},{key:"*",text:"*"},{key:"/",text:"/"},{key:"^",text:"^"},{key:"%",text:"%"},{key:"π",text:"π"}],wizard:{currentStep:"step1"}});this.getView().setModel(e);this.byId("step3").attachActivate(this.updateParamIdsText,this);e.setDefaultBindingMode(sap.ui.model.BindingMode.TwoWay)},onAddOperation:function(e){var t=this.getView().byId("relationInput");var a=e.getSource().getText();var r=t.getValue();t.setValue(r+" "+a+" ")},onParamCountChange:function(e){var t=this.getView().getModel();var a=parseInt(e.getParameter("value"))||0;t.setProperty("/paramCount",a);var r=this.getView().byId("_IDGenVBox8");r.removeAllItems();var s=[];for(var o=1;o<=a;o++){var n=new sap.m.VBox({items:[new sap.m.Label({text:"ParamID "+o+"*"}),new sap.m.Input({value:{path:"/params/"+(o-1)+"/id",mode:sap.ui.model.BindingMode.TwoWay},placeholder:"Enter ParamID "+o}),new sap.m.Label({text:"Param Description "+o+"*"}),new sap.m.Input({value:{path:"/params/"+(o-1)+"/description",mode:sap.ui.model.BindingMode.TwoWay},placeholder:"Enter Param Description "+o})]});r.addItem(n);s.push({id:"",description:""})}t.setProperty("/params",s)},updateParamIdsText:function(){var e=this.getView().getModel();var t=e.getProperty("/params")||[];var a=e.getProperty("/paramCount");var r=this.getView().byId("paramIdsContainer");r.removeAllItems();t.forEach((t,a)=>{var s=t.id&&t.id.trim()?t.id:"P"+(a+1);var o=new sap.m.Button({text:s,press:()=>{var t=this.getView().byId("relationInput");var a=t.getValue();t.setValue(a+" "+s+" ");e.setProperty("/relationText",t.getValue())},layoutData:new sap.m.FlexItemData({styleClass:"sapUiSmallMarginBegin sapUiSmallMarginEnd"})});r.addItem(o)});var s=this.getView().byId("testInputsContainer");s.removeAllItems();var o=[];for(var n=0;n<a;n++){var i=t[n]?t[n].id:"Param"+(n+1);console.log(i);var l=new Label({text:i+" Value:"});var p=new Input({value:"{/testValues/"+n+"}",type:"Number"});s.addItem(l);s.addItem(p);o.push("")}e.setProperty("/testValues",o)},onShowResult:function(){var oModel=this.getView().getModel();var relation=oModel.getProperty("/relationText");var params=oModel.getProperty("/params");var testValues=oModel.getProperty("/testValues");var expression=relation;for(var i=0;i<params.length;i++){var paramId=params[i].id;var value=testValues[i]||"0";expression=expression.replace(new RegExp(paramId,"g"),value)}try{var result=eval(expression);sap.m.MessageBox.information("Result: "+result,{title:"Calculation Result",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){console.log("User confirmed result")}}})}catch(e){MessageToast.show("Invalid expression: "+e.message)}},onSaveFormula:function(){var e=this.getView();var t=this.getOwnerComponent().getModel();var a=e.byId("formulaNameInput").getValue();var r=e.byId("formulaDescriptionInput").getValue();var s=e.byId("relationInput").getValue();var o=this.getView().getModel();var n=o.getProperty("/params");var i=n.map(e=>e.id);var l=n.map(e=>e.description);var p=i.length;if(!a||!r){sap.m.MessageToast.show("Please fill in all required fields.");return}var u={formula:a,description:r,numberOfParameters:p,parameterIds:i,parameterDescriptions:l,formulaLogic:s,expression:s};fetch("./odata/v4/sales-cloud/Formulas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).then(e=>{if(!e.ok){throw new Error("Failed to create formula: "+e.statusText)}return e.json()}).then(t=>{sap.m.MessageBox.success("Formula saved successfully!,Press OK To return to the main page",{title:"Success",actions:[sap.m.MessageBox.Action.OK],onClose:function(e){if(e===sap.m.MessageBox.Action.OK){var t=sap.ui.core.UIComponent.getRouterFor(this);t.navTo("formulas")}}.bind(this)});console.log("Created Formula:",t);var a=this.getView().getModel();var r=a.getProperty("/Formulas")||[];r.push(t);a.setProperty("/Formulas",r);e.byId("formulaNameInput").setValue("");e.byId("formulaDescriptionInput").setValue("");e.byId("relationInput").setValue("");var s=this.getView().byId("testInputsContainer");s.removeAllItems();o.setProperty("/params",[]);o.setProperty("/paramCount",0);o.setProperty("/testValues",[])}).catch(e=>{console.error("Error creating Formula:",e);sap.m.MessageBox.error("Error: "+e.message)})},onOperationSelect:function(e){var t=this.getView().byId("relationInput");var a=e.getParameter("selectedItem").getKey();var r=t.getValue();t.setValue(r+" "+a+" ")}})});
//# sourceMappingURL=Formula.controller.js.map